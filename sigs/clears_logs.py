from abstracts import Signature
from threemon.reader import EventTypes
from threemon import process_pb2
import re

# Original Signature:
# https://github.com/cuckoosandbox/community/blob/master/modules/signatures/windows/clears_logs.py

class ClearsEventLogs(Signature):
    event_types = [EventTypes.PROCESS]

    description = "Uses Windows command to clear Windows event logs"
    TTPS = ["T1070"]

    utilities = [
        "wevtutil cl",
        "wevtutil.exe cl"
    ]

    def wants_event(self, process_event):
        if process_event.ProcessStatus == process_pb2.Create:
            return True
        return False


    def process_event(self, process):
        for u in self.utilities:
            if u in process.command:
                self.trigger()


class ClearPermissionEventLogs(Signature):
    event_types = [EventTypes.PROCESS]

    description = "Manipulates event log permissions likely to enable clearing of logs"
    TTPS = ["T1222"]

    utilities = [
        "wevtutil sl",
        "wevtutil.exe sl"
    ]

    def wants_event(self, process_event):
        if process_event.ProcessStatus == process_pb2.Create:
            return True
        return False


    def process_event(self, process):
        for u in self.utilities:
            if u in process.command:
                self.trigger()

            


