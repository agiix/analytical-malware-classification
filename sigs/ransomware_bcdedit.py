from abstracts import Signature
from threemon.reader import EventTypes
from threemon import process_pb2
import re

# Original Signature:
# https://github.com/cuckoosandbox/community/blob/master/modules/signatures/windows/ransomware_bcdedit.py

class RansomwareBcdedit(Signature):

    event_types = [EventTypes.PROCESS]

    description = "Runs bcdedit commands specific to ransomware"
    TTPS = ["T1047"]

    indicator = (
        "bcdedit.*/set.*(bootems|optionsedit|advancedoptions|bootstatuspolicy|recoveryenabled)"
    )


    def wants_event(self, process_event):
        if process_event.status == process_pb2.Create:
            return True
        return False


    def process_event(self, process):
        if re.search(self.indicator, process.command):
            self.trigger()

