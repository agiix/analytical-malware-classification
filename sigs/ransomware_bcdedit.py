from abstracts import Signature
from threemon.reader import EventTypes
from threemon import process_pb2

# Original Signature:
# https://github.com/cuckoosandbox/community/blob/master/modules/signatures/windows/ransomware_bcdedit.py

class RansomwareBcdedit(Signature):

    event_types = {
        EventTypes.PROCESS: {process_pb2.Create}
    }

    description = "Runs bcdedit commands specific to ransomware"
    TTPS = ["T1047"]

    proc_indicators = [
        "bcdedit.*/set.*(bootems|optionsedit|advancedoptions|bootstatuspolicy|recoveryenabled)"
    ]

    def process_event(self, process):
        for proc in self.proc_indicators:
            if self.check_value(pattern=proc, subject=process.command, regex=True, all=True):
                self.trigger()

