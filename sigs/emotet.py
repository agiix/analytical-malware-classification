from abstracts import Signature
from threemon.reader import EventTypes
from threemon import process_pb2


"""Checks if the executable get's launched twice, since it is a typical
Emotet behavior to launch a second instance watching over the otherâ€™s back.
The function checks the procid and the parentprocid to confirm that the 
second instance was launched from the first instance. 
"""

class DoubleLaunch(Signature):

    event_types = {
        EventTypes.PROCESS: {process_pb2.Create}
    }

    description = "An executable was lunched twice, could indicate Emotet behavior"
    TTPS = ["None"]

    _launched = []

    #Should it check, whether the process was double lunched by a malicious procid?  
    """
    def process_event(self, process):
        if process.orig == False:
            if process.image in self._launched:
                self.trigger()
            else:
                self._launched.append(process.image)"""
