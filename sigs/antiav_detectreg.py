from abstracts import Signature
from threemon.reader import EventTypes
from threemon import registry_pb2

class BitdefenderDetectLibs(Signature):
    event_types = [EventTypes.REGISTRY]

    description = "Attempts to identify installed AV products by registry key"
    TTPS = ["T1063", "T1012"]

    reg_indicators = [
        "\\Software\\Wow6432Node\\Avg",
        "\\Software\\Avg",
        "\\Software\\Wow6432Node\\Software\\",
        "\\Software\\AVAST\\Software\\",
        "\\Software\\Wow6432Node\\Avira",
        "\\Software\\Avira",
        "\\Software\\Bitdefender",
        "\\Software\\Wow6432Node\\Bitdefender",    
        "\\Software\\Wow6432Node\\Coranti",
        "\\Software\\Coranti",    
        "\\Software\\Wow6432Node\\Data\\Fellows\\F-Secure",
        "\\Software\\Data\\Fellows\\F-Secure",
        "\\Software\\Wow6432Node\\Doctor\\Web",
        "\\Software\\Doctor\\Web",
        "\\Software\\Wow6432Node\\ESET",
        "\\Software\\ESET",
        "\\Software\\G\\Data",
        "\\Software\\Wow6432Node\\G\\Data",
        "\\Software\\Wow6432Node\\Symantec",
        "\\Software\\Symantec",
        "\\Software\\Wow6432Node\\KasperskyLab",
        "\\Software\\KasperskyLab",
        "\\Software\\Wow6432Node\\McAfee",
        "\\Software\\McAfee",
        "\\Software\\Wow6432Node\\McAfee\.com",
        "\\Software\\McAfee\.com",
        "\\Software\\Wow6432Node\\Microsoft\\Microsoft\\Antimalware",
        "\\Software\\Microsoft\\Microsoft\\Antimalware",
        "\\Software\\Wow6432Node\\Network\\Associates\\TVD",
        "\\Software\\Network\\Associates\\TVD",
        "\\Software\\Wow6432Node\\Panda\\Software",
        "\\Software\\Panda\\Software",
        "\\Software\\Wow6432Node\\rising",
        "\\Software\\rising",
        "\\Software\\Wow6432Node\\Softed\\ViGUARD",
        "\\Software\\Softed\\ViGUARD",
        "\\Software\\Wow6432Node\\Sophos",
        "\\Software\\Sophos",
        "\\Software\\Wow6432Node\\TrendMicro",
        "\\Software\\TrendMicro",
        "\\Software\\Wow6432Node\\VBA32",
        "\\Software\\VBA32",
        "\\Software\\Wow6432Node\\Zone\\Labs\\ZoneAlarm",
        "\\Software\\Zone\\Labs\\ZoneAlarm",
        "\\Software\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\App\\Paths\\mbam.exe",
        "\\Software\\Microsoft\\Windows\\CurrentVersion\\App\\Paths\\mbam.exe",
        "\\SYSTEM\\CurrentControlSet\\services\\Avg",
        "\\SYSTEM\\ControlSet001\\services\\Avg",
        "\\SYSTEM\\CurrentControlSet\\services\\AVP",
        "\\SYSTEM\\ControlSet001\\services\\AVP",
        "\\SYSTEM\\CurrentControlSet\\services\\avast!\\Antivirus",
        "\\SYSTEM\\ControlSet001\\services\\avast!\\Antivirus",
        "\\SYSTEM\\CurrentControlSet\\services\\RsMgrSvc",
        "\\SYSTEM\\ControlSet001\\services\\RsMgrSvc",
        "\\SYSTEM\\CurrentControlSet\\services\\fshoster",
        "\\SYSTEM\\ControlSet001\\services\\fshoster",
        "\\SYSTEM\\CurrentControlSet\\services\\cmdvirth",
        "\\SYSTEM\\ControlSet001\\services\\cmdvirth",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\AVG_UI",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\AVG_UI",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\AVP",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\AVP",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\mcui_exe",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\mcui_exe",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\mcpltui_exe",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\mcpltui_exe",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\Bdagent",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Bdagent",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\Trend\\Micro\\Titanium",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Trend\\Micro\\Titanium",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Trend\\Micro\\Client\\Framework",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\Trend\\Micro\\Client\\Framework",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\avast",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\avast",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\MSC",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\MSC",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\BullGuard",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\BullGuard",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\Sophos\\AutoUpdate\\Monitor",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Sophos\\AutoUpdate\\Monitor",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\SpIDerAgent",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\SpIDerAgent",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\APVXDWIN",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\APVXDWIN",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\WRSVC",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\WRSVC",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\emsisoft\\anti-malware",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\emsisoft\\anti-malware",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\ISTray",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\ISTray",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\G\\Data\\AntiVirus\\Tray",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\G\\Data\\AntiVirus\\Tray",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\ZoneAlarm",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\ZoneAlarm",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\Bkav",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Bkav",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\V3\\Application",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\V3\\Application",
        "\\SOFTWARE\\Wow6432Node\\Microsoft\\Windows\\CurrentVersion\\Run\\Baidu\\Antivirus",
        "\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Run\\Baidu\\Antivirus",
    ]


    def registry_event(self, registry):
        for reg in self.reg_indicators:
            if reg in registry.path:
                self.trigger()
