from abstracts import Signature
from threemon.reader import EventTypes
from threemon import process_pb2
from report import mapping

# Original Signature:
# https://github.com/cuckoosandbox/community/blob/master/modules/signatures/windows/antivm_psuedo_device.py

class AntiVMSharedDevice(Signature):

    event_types = {
        EventTypes.PROCESS: {process_pb2.Create}
    }

    description = "Attempts to detect a virtual machine by the use of a pseudo device"
    TTPS = ["T1082"]
    events = {}

    def process_event(self, process):
        if process.image.endswith(("\\hgfs", "\\vmci")):
            self.events = mapping(self.events, process)
            self.trigger()
